{% append style.inline %}

.input-field .postfix {
    font-size: 2rem;
    position: absolute;
    right:0;
    transition: color 0.2s ease 0s;
    width: 3rem;
}
.input-field .postfix.active {
color:#26a69a;
}

.input-field .postfix ~ input, .input-field .postfix ~ textarea, .input-field .postfix ~ label, .input-field .postfix ~ .validate ~ label, .input-field .postfix ~ .autocomplete-content {
    margin-rigth: 3rem;
    width: calc(100% - 3rem);
}
{% /append %}

{% append js.onready %}

$(".button-collapse").sideNav();
$('select').material_select();
$('#n_col').on('change', 'select', function(){ console.log("got you"); });
$('.campojoin > i').click(function() {
  openJoin('campojoin');
});


{% /append %}

{% append js.inline %}
function openDet(id){
  $('#modal1').attr('data-key',id);
  $('#modal-tit').html("Detalles del Campo: <span class='red-text'>"+id);
  $('._pedir').each(function() {

    if ( ($(this).attr('data-type')=='text')||($(this).attr('data-type')=='sel')||($(this).attr('data-type')=='range') ){
      $(this).val($('#field-'+id+'-'+$(this).attr('id')).val());  
    }

    if ( ($(this).attr('data-type')=='switch')||($(this).attr('data-type')=='check') ){
      if ($('#field-'+id+'-'+$(this).attr('id')).val()==$(this).attr('data-on')){
        $(this).attr('checked',true);  
      }else{
        $(this).attr('checked',false);  
      }
    }
  });


  $('select').material_select();
  $('#modal1').openModal();
  valFunc();
  Materialize.updateTextFields();

}

function openJoin(id){
  $('#modal2').attr('data-key',id);

  var dato=$('#campojoin').val();

  if (dato==''){
    $('#n_table, #n_col').val(-1);

  }else{
    var datos=dato.split('.');
    $('#n_table').val(datos[0]);
    getCampos(datos[1]);
    
  }

  $('#modal2').openModal();
 $('select').material_select();
}


function closeDet(){
  var id=$('#modal1').attr('data-key');

 $('._pedir').each(function() {

    if ( ($(this).attr('data-type')=='text')||($(this).attr('data-type')=='sel')||($(this).attr('data-type')=='range') ){
      $('#field-'+id+'-'+$(this).attr('id')).val($(this).val())
    }

    if ( ($(this).attr('data-type')=='switch')||($(this).attr('data-type')=='check')  ){
      if ($(this).is(':checked')){
        $('#field-'+id+'-'+$(this).attr('id')).val($(this).attr('data-on'));
      }else{
        $('#field-'+id+'-'+$(this).attr('id')).val($(this).attr('data-off'));
      }
      
    }

  
  });


  $('#modal1').closeModal();
}

function closeJoin(){
  var id=$('#modal2').attr('data-key');
  var dato=$('#n_table').val()+'.'+$('#n_col').val();
  $('#'+id).val( dato );

  
  Materialize.updateTextFields();
  $('#modal2').closeModal();
}

function valFunc(){
  var valor=$('#funcion').val();
  //alert(valor);

  $('#funcion').parent().parent().removeClass('s10').addClass('s12');
  $('#dec').parent().parent().hide();
  if (valor=='bdf'){
    $('#funcion').parent().parent().removeClass('s12').addClass('s10');
    $('#dec').parent().parent().removeClass('s12').addClass('s2').show();
  }

  $('#fcustom').parent().hide();
  if (valor=='custom'){
    $('#funcion').parent().parent().removeClass('s12').addClass('s10');
    $('#fcustom').parent().removeClass('s12').addClass('s2').show();
  }


 valor=$('#tipolista').val();
 // alert(valor);
  
  $('#tipolista').parent().parent().removeClass('s6').addClass('s12');
  $('#campojoin').parent().hide();
  if (valor=='join'){
    $('#tipolista').parent().parent().removeClass('s12').addClass('s6');
    $('#campojoin').parent().removeClass('s12').addClass('s6').show();
  }
  
}

function clicChecked(id){
  $('#'+id).attr('checked',!$('#'+id).is(':checked')); 
  return false;
}

function getCampos(id){

  var tabla=$('#n_table').val();
  var oldvalue=$('#n_table').attr('oldvalue');
  if (tabla!='-1'){
    $.ajax({
  url: 'index.php?crud=getCampos',
  data: {
    table: tabla
  },
  success: function( result ) {

    $('#n_col').html(result);
    if (id!=''){
    
      $('#n_col').val(id);
    }
    $('select').material_select();

  }
});
  }
}

{% /append %}

{% var menunavigation=1 %}


<!-- <h2 class="header">   Tabla: <span class="grey-text text-lighten-4">{% echo $database.'.' %}</span>{% echo $tableName %}</h2> -->



<ul id="nav-mobile" class="side-nav" >
  <li><div class="divider"></div></li>
  <li><a class="subheader">{% echo strtoupper($tableName) %}</a></li>
  <li><div class="divider"></div></li>
  <li class="no-padding">
   <ul class="collapsible" data-collapsible="expandable">

    {% foreach $field in $_table %}

    <li >
      <div class="collapsible-header waves-effect {% if ($field['key']=='PRI')%}red-text{% /if %} "><i class="tiny material-icons ">{% if ($field['key']=='PRI')%}stars{% /if %}{% if ($field['key']=='MUL')%}vpn_key{% /if %}{% if ($field['key']=='')%}adjust{% /if %}</i>{% echo $field_i; %}</div>
      <div class="collapsible-body">
        <p>
          Tipo:{% echo $field['type']; %} {% if ($field['args'][0]) %} ( {% echo $field['args'][0] %} {% if ($field['args'][1]) %} , {% echo $field['args'][1] %} {% /if %} ) {% /if %}
          {% if ($field['null']=='NO') %} <br>Null: NO  {% /if %}
          {% if ($field['default']!='') %} <br>Default: {% echo $field['default'] %}   {% /if %}
          {% if ($field['extra']!='') %} <br>{% echo $field['extra'] %}   {% /if %}
        </p>
      </div>
    </li>
    {% /foreach %}
  </ul>        

</li>
</ul>


<div class="row">
  <div class="col s12">
    <ul class="tabs z-depth-1"">
      <li class="tab col s4"><a class="active" href="#campos">CAMPOS</a></li>
      <li class="tab col s4"><a  class="" href="#listas">LISTA</a></li>
      <li class="tab col s4 "><a  class="" href="#formulario">FORMUARIO</a></li>
    </ul>
  </div>
  <div id="campos" class="col s12">
    
    {% include campos.html %}

  </div>
  <div id="listas" class="col s12">Lista</div>
  <div id="formulario" class="col s12">Formulario</div>
</div>

 <!-- Modal Structure -->

  <div id="modal1" data-key="" class="modal modal-fixed-footer">
   <h4 id="modal-tit" style="border-bottom: 1px solid rgba(0, 0, 0, 0.1);background-color: #fafafa;border-radius:  2px 2px 0 0;height: 56px;position: absolute;top: 0;padding: 4px 6px;width: 100%;">Modal Header</h4>
    <div class="modal-content" style="margin-top:56px;height:calc(100% - 112px);">
      <div class="row">

      {% php $ctam='s12'; %}
  {% foreach $pedir in $_pedir %}
    
    {% if ($pedir['type']=='text') %}

        <div class="input-field col {% echo $ctam; %} {% echo $pedir_i; %}">
        {% if ($pedir['icon']!='') %}        
        <i class="material-icons {% echo $pedir['icon-type'];%}" >{% echo $pedir['icon'];%}</i>
        {% /if %}
          <input id="{% echo $pedir_i; %}" name='{% echo $pedir_i; %}' type="text" class="validate _pedir" data-type="{% echo $pedir['type']; %}" >
          <label for="{% echo $pedir_i; %}" data-error="{% echo $pedir['error']; %}" data-success="{% echo $pedir['ok']; %}">{% echo $pedir['text']; %}</label>
        </div>

    {% /if %}

    {% if ($pedir['type']=='sel') %}

  <div class="input-field col {% echo $ctam; %} {% echo $pedir_i; %}">
    <select id="{% echo $pedir_i; %}" name='{% echo $pedir_i; %}' class="validate _pedir" data-type="{% echo $pedir['type']; %}" {% if ($pedir_i=='funcion') %} onchange="valFunc();" {% /if %} >
      {% echo $pedir['opt']; %}
    </select>
    <label   for="{% echo $pedir_i; %}" data-error="{% echo $pedir['error']; %}" data-success="{% echo $pedir['ok']; %}">{% echo $pedir['text']; %}</label>
  </div>

    {% /if %}

    {% if ($pedir['type']=='range') %}

  <div class="input-field col {% echo $ctam; %} {% echo $pedir_i; %}">
    <p class="range-field">
      <input type="range" id="{% echo $pedir_i; %}" name='{% echo $pedir_i; %}' class="validate _pedir" data-type="{% echo $pedir['type']; %}"  min="{% echo $pedir['min']; %}" max="{% echo $pedir['max']; %}" >
    </p>
    <label  for="{% echo $pedir_i; %}"  data-error="{% echo $pedir['error']; %}" data-success="{% echo $pedir['ok']; %}">{% echo $pedir['text']; %}</label>
  </div>

    {% /if %}

    {% if ($pedir['type']=='switch') %}

  <div class=" col {% echo $ctam; %} {% echo $pedir_i; %}">
  <label >{% echo $pedir['text']; %}</label>
    <div class="switch" onclick="clicChecked('{% echo $pedir_i; %}')" >
    <label>
      {% echo $pedir['off']; %}
      <input type="checkbox" id="{% echo $pedir_i; %}" name='{% echo $pedir_i; %}' class=" _pedir" data-type="{% echo $pedir['type']; %}" data-on="{% echo $pedir['onval']; %}" data-off="{% echo $pedir['offval']; %}"  >
      <span class="lever"></span>
      {% echo $pedir['on']; %}
    </label>
  </div>
   
  </div>

    {% /if %}

    {% if ($pedir['type']=='check') %}

 <div class="col {% echo $ctam; %} {% echo $pedir_i; %}">
    <p onclick="clicChecked('{% echo $pedir_i; %}')">
      <input type="checkbox" id="{% echo $pedir_i; %}" name='{% echo $pedir_i; %}' class=" _pedir" data-type="{% echo $pedir['type']; %}" data-on="{% echo $pedir['onval']; %}" data-off="{% echo $pedir['offval']; %}" />
      <label   >{% echo $pedir['text']; %}</label>
    </p>
  </div>
   
    {% /if %}



  {% /foreach %}

    </div>

   
    </div>
    <div class="modal-footer">
     <button class="modal-action  waves-effect waves-green btn-flat" onclick="closeDet();">Ok</button>
     
      
    </div>
  </div>
  
 <!-- Modal Structure -->
  <div id="modal2" data-key="" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4 id="modal-tit">Escojer Tabla y Campo</h4>
      

      <div class="row">


  <div class="input-field col {% echo $ctam; %}">
    <select id="n_table" name='n_table' class="validate" onchange="getCampos();"  >
    {% echo $_tablas; %}
    </select>
    <label   for="n_table" >Tabla:</label>
  </div>

    </div>

   
      <div class="row">


  <div class="input-field col {% echo $ctam; %}">
  
    <select id="n_col" name='n_col' class="validate"   >
    </select>
    <label   for="n_col" >Columna:</label>
  </div>

    </div>



    </div>
    <div class="modal-footer">
     <button class="modal-action  waves-effect waves-green btn-flat" onclick="closeJoin();">Ok</button>
      
    </div>
  </div>


