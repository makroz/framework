{"crud":"generar","singular":"Ingreso a Almacen","plural":"Ingresos a Almacen","seguridad":"resp","listAction":"-1","field":{"pk":{"label":"Id","labelf":"","uso":"-1","usof":"oculto","tam":"s12","posf":"0","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"show","tamlista":"60px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_pk","i_pre":"","i_pos":""},"fecha":{"label":"Fecha","labelf":"","uso":"A","usof":"date","tam":"s3","posf":"0","funcion":"date","fcustom":"","dec":"0","checkvalor":"","tipolista":"show","tamlista":"120px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"1","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fecha","i_pre":"<div class=\"row form-config-section componente i_c-section bindered\" id=\"c-section-0\" data-campo=\"c-section-0\" data-type=\"c-section\"> <div class=\"dropin row               \">","i_pos":""},"fk_almacenes":{"label":"Almacen","labelf":"","uso":"A","usof":"selecdb","tam":"s6","posf":"2","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"217px","checklista":"","listalista":"","campojoin":"almacenes|nombre|0|||","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"1","var":"_fk_almacenes","i_pre":"","i_pos":""},"fk_prod":{"label":"Producto","labelf":"","uso":"A","usof":"buscardb","tam":"s9","posf":"3","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"","checklista":"","listalista":"","campojoin":"prod|nom|0||fk_unidades|left join unidades on (fk_unidades=unidades.pk)","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fk_prod","i_pre":"","i_pos":""},"cant":{"label":"Cant","labelf":"","uso":"A","usof":"float","tam":"s2","posf":"4","funcion":"bdf","fcustom":"","dec":"2","checkvalor":"","tipolista":"","tamlista":"113px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_cant","i_pre":"","i_pos":""},"costo":{"label":"Costo","labelf":"","uso":"A","usof":"float","tam":"s4","posf":"6","funcion":"bdf","fcustom":"","dec":"2","checkvalor":"","tipolista":"-1","tamlista":"80","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"1","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_costo","i_pre":"","i_pos":""},"fk_unidades":{"label":"Unidad","labelf":"","uso":"A","usof":"selecdb","tam":"s1","posf":"5","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"163px","checklista":"","listalista":"","campojoin":"unidades|nombre|0|(tipo='%s')|tipo|","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fk_unidades","i_pre":"","i_pos":""},"tipo":{"label":"Tipo","labelf":"Tipo de Ingreso","uso":"A","usof":"selec","tam":"s3","posf":"1","funcion":"st","fcustom":"","dec":"0","checkvalor":"1\/0","tipolista":"lista","tamlista":"228px","checklista":"","listalista":"C|Compra||*I|Inventario Inicial||*T|Traspaso||*D|Devolucion||*A|Ajuste||*","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"C","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"1","var":"_tipo","i_pre":"","i_pos":""},"tipodoc":{"label":"Tipo Doc.","labelf":"Tipo de Documento","uso":"A","usof":"selec","tam":"s4","posf":"7","funcion":"st","fcustom":"","dec":"0","checkvalor":"1\/0","tipolista":"lista","tamlista":"108px","checklista":"","listalista":"F|Factura||*R|Recibo||*X|Ninguno||*","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"F","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"","var":"_tipodoc","i_pre":"","i_pos":""},"nfac":{"label":"Doc","labelf":"No. de Factura\/Recibo","uso":"A","usof":"alfa","tam":"s4","posf":"8","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"show","tamlista":"201px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_nfac","i_pre":"","i_pos":""},"fecven":{"label":"Vence","labelf":"Fecha de Vencimiento","uso":"A","usof":"date","tam":"s6","posf":"10","funcion":"date","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"176px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fecven","i_pre":"","i_pos":""},"serial":{"label":"Serial","labelf":"","uso":"A","usof":"alfa","tam":"s6","posf":"9","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"192.5px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"","readonly":"","unico":"","f2":"","listaeventos":"","validar":"","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_serial","i_pre":"","i_pos":""},"fk_resp":{"label":"Resp","labelf":"Responsable","uso":"A","usof":"join","tam":"s12","posf":"11","funcion":"useract","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"124px","checklista":"","listalista":"","campojoin":"resp|nombre||","f1":"","search":"1","required":"1","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fk_resp","i_pre":"","i_pos":"<\/div><\/div>"},"created_":{"label":"Created_","labelf":"","uso":"G","usof":"","tam":"s12","posf":"13","funcion":"datetimesystem","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"120","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_created_","i_pre":"","i_pos":""},"modified_":{"label":"Modified_","labelf":"","uso":"A","usof":"-1","tam":"s12","posf":"14","funcion":"datetimesystem","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"120","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"","f2":"","listaeventos":"","validar":"","defVal":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_modified_","i_pre":"","i_pos":""},"status":{"label":"St","labelf":"","uso":"G","usof":"-1","tam":"s12","posf":"13","funcion":"custom","fcustom":"1","dec":"0","checkvalor":"1\/0","tipolista":"-1","tamlista":"45px","checklista":"","listalista":"","campojoin":"","f1":"","search":"0","required":"0","readonly":"","unico":"","f2":"","listaeventos":"","validar":"","defVal":"1","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_status","i_pre":"","i_pos":""}},"codejs":"function onChangeProd(){\r\n  var dato=$('#fk_prod').val();\r\n    sel=$('#fk_prod').data('tag');\r\n    if (sel>0){\r\n      reaction('campo=fk_unidades&arg1=tipo&sel='+sel,'getListFor','','#fk_unidades',actualizarUI);\r\n    }\r\n}\r\n_setTask(onChangeProd,'_buscarDb');","codejsopenform":"onChangeProd();\r\n","codecontroler":"\r\n","codeaftersave":"$datos=$this->_model->loadToArray();\r\n$database = \\Mk\\Registry::get(\"database\");\r\n$idProdAlm=$database->query()->first(\"select pk, cant from prodalm where (fk_prod={$datos['fk_prod']})and(fk_almacenes={$datos['fk_almacenes']}) limit 1\");\r\n$data['pk']=$idProdAlm['pk'];\r\n$data['cant']=$idProdAlm['cant']+$datos['cant'];\r\n\r\nif ($action=='add'){\r\n\t$datap['cant']='cant+'.$datos['cant'];\r\n}\r\nif ($action=='edit'){\r\n  if (($datos['fk_prod']!=$this->dataAnt['fk_prod'])||($datos['fk_almacenes']!=$this->dataAnt['fk_almacenes'])){\r\n    $database->execute(\"update prodalm set cant=cant-{$this->dataAnt['cant']} where (fk_prod={$this->dataAnt['fk_prod']})and(fk_almacenes={$this->dataAnt['fk_almacenes']})\");\r\n  }else{\r\n    $data['cant']=$idProdAlm['cant']+$datos['cant']-$this->dataAnt['cant'];\t\r\n  }\r\n  $datap['cant']='cant+'.($datos['cant']-$this->dataAnt['cant']);\r\n}\r\nif (!($idProdAlm['pk']>0)){\r\n\t$data=$datos;\r\n\t$data['pk']='';\r\n}\r\n$prodAlm=new ProdAlm();\r\n$prodAlm->saveFromArray($data);\r\n$prod=new Prod();\r\n$datap['pk']=$datos['fk_prod'];\r\n$prod->saveFromArray($datap);","codebeforesave":"if ($action=='edit'){\r\n  $database = \\Mk\\Registry::get(\"database\");\r\n  $this->dataAnt=$database->query()->first(\"select pk, cant, fk_prod, fk_almacenes from ingalm where (pk={$this->_model->pk}) limit 1\");\r\n}","codeafterdelete":"$database = \\Mk\\Registry::get(\"database\");\r\n$datos=$database->query()->first(\"select pk,cant,fk_prod,fk_almacenes from ingalm where (pk={$id}) limit 1\");\r\n$database->execute(\"update prodalm set cant=cant-{$datos['cant']} where (fk_prod={$datos['fk_prod']})and(fk_almacenes={$datos['fk_almacenes']})\");\t\t\r\n$database->execute(\"update prod set cant=cant-{$datos['cant']} where (pk={$datos['fk_prod']})\");\t\r\n","codebeforedelete":"","listatamvar1":"fk_prod"}