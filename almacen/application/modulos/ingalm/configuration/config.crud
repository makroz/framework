{"crud":"generar","singular":"Ingreso a Almacen","plural":"Ingresos a Almacen","seguridad":"resp","listAction":"-1","field":{"pk":{"label":"Id","labelf":"","uso":"-1","usof":"oculto","tam":"s12","posf":"0","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"show","tamlista":"62px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_pk","i_pre":"","i_pos":""},"fecha":{"label":"Fecha","labelf":"","uso":"A","usof":"date","tam":"s2","posf":"0","funcion":"date","fcustom":"","dec":"0","checkvalor":"","tipolista":"show","tamlista":"124px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"hoy","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fecha","i_pre":"<div class=\"row form-config-section componente i_c-section bindered\" id=\"c-section-0\" data-campo=\"c-section-0\" data-type=\"c-section\"> <div class=\"dropin row                \">","i_pos":""},"fk_almacenes":{"label":"Almacen","labelf":"","uso":"A","usof":"selecdb","tam":"s8","posf":"2","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"188px","checklista":"","listalista":"","campojoin":"almacenes|nombre|0|||","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"1","var":"_fk_almacenes","i_pre":"","i_pos":""},"fk_almacenes_2":{"label":"Alm Origen","labelf":"Almacen Origen","uso":"A","usof":"selecdb","tam":"s4","posf":"3","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"177px","checklista":"","listalista":"","campojoin":"almacenes|nombre|0|||","f1":"","search":"1","required":"0","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"1","var":"_fk_almacenes_2","i_pre":"","i_pos":""},"fk_prod":{"label":"Producto","labelf":"","uso":"A","usof":"buscardb","tam":"s9","posf":"4","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"","checklista":"","listalista":"","campojoin":"prod|nom|0||fk_unidades|left join unidades on (fk_unidades=unidades.pk)|prod.codbarra:1:e,prod.nom:1:like","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"grabarSeguir","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fk_prod","i_pre":"","i_pos":""},"cant":{"label":"Cant","labelf":"","uso":"A","usof":"float","tam":"s2","posf":"5","funcion":"bdf","fcustom":"","dec":"2","checkvalor":"","tipolista":"","tamlista":"116px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"grabarSeguir","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_cant","i_pre":"","i_pos":""},"fk_unidades":{"label":"Unidad","labelf":"","uso":"A","usof":"selecdb","tam":"s1","posf":"6","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"109px","checklista":"","listalista":"","campojoin":"unidades|nombre|0|(tipo='%s')|tipo|","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"grabarSeguir","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fk_unidades","i_pre":"","i_pos":""},"costo":{"label":"Costo","labelf":"","uso":"A","usof":"float","tam":"s4","posf":"7","funcion":"bdf","fcustom":"","dec":"2","checkvalor":"","tipolista":"-1","tamlista":"80","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"grabarSeguir","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_costo","i_pre":"","i_pos":""},"tipo":{"label":"Tipo","labelf":"Tipo de Ingreso","uso":"A","usof":"selec","tam":"s2","posf":"1","funcion":"st","fcustom":"","dec":"0","checkvalor":"1\/0","tipolista":"lista","tamlista":"233px","checklista":"","listalista":"C|Compra||*I|Inventario Inicial||*T|Traspaso||*D|Devolucion||*A|Ajuste||*","campojoin":"","f1":"","search":"1","required":"1","readonly":"0","unico":"0","f2":"","listaeventos":"onchange|onChangeTipo();|*","validar":"","defVal":"C","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"1","var":"_tipo","i_pre":"","i_pos":""},"tipodoc":{"label":"Tipo Doc.","labelf":"Tipo de Documento","uso":"A","usof":"selec","tam":"s4","posf":"8","funcion":"st","fcustom":"","dec":"0","checkvalor":"1\/0","tipolista":"lista","tamlista":"142px","checklista":"","listalista":"F|Factura||*R|Recibo||*X|Ninguno||*","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"F","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"","var":"_tipodoc","i_pre":"","i_pos":""},"nfac":{"label":"Doc","labelf":"No. de Factura\/Recibo","uso":"A","usof":"alfa","tam":"s4","posf":"9","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"show","tamlista":"187px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","classForm":"grabarSeguir","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_nfac","i_pre":"","i_pos":""},"fecven":{"label":"Vence","labelf":"Fecha de Vencimiento","uso":"A","usof":"date","tam":"s6","posf":"11","funcion":"date","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"176px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"0","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","classForm":"grabarSeguir","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fecven","i_pre":"","i_pos":""},"serial":{"label":"Serial","labelf":"","uso":"A","usof":"alfa","tam":"s6","posf":"10","funcion":"st","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"192.5px","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"","readonly":"","unico":"","f2":"","listaeventos":"","validar":"","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_serial","i_pre":"","i_pos":""},"fk_resp":{"label":"Resp","labelf":"Responsable","uso":"A","usof":"join","tam":"s12","posf":"12","funcion":"useract","fcustom":"","dec":"0","checkvalor":"","tipolista":"join","tamlista":"126px","checklista":"","listalista":"","campojoin":"resp|nombre||","f1":"","search":"1","required":"1","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"numerico","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_fk_resp","i_pre":"","i_pos":"<\/div><\/div>"},"created_":{"label":"Created_","labelf":"","uso":"G","usof":"","tam":"s12","posf":"13","funcion":"datetimesystem","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"120","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"0","f2":"","listaeventos":"","validar":"","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_created_","i_pre":"","i_pos":""},"modified_":{"label":"Modified_","labelf":"","uso":"A","usof":"-1","tam":"s12","posf":"14","funcion":"datetimesystem","fcustom":"","dec":"0","checkvalor":"","tipolista":"-1","tamlista":"120","checklista":"","listalista":"","campojoin":"","f1":"","search":"1","required":"0","readonly":"","unico":"","f2":"","listaeventos":"","validar":"","defVal":"","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_modified_","i_pre":"","i_pos":""},"status":{"label":"St","labelf":"","uso":"G","usof":"-1","tam":"s12","posf":"13","funcion":"custom","fcustom":"1","dec":"0","checkvalor":"1\/0","tipolista":"-1","tamlista":"45px","checklista":"","listalista":"","campojoin":"","f1":"","search":"0","required":"0","readonly":"","unico":"","f2":"","listaeventos":"","validar":"","defVal":"1","classForm":"","classLista":"","codejs":"","codejsopenform":"","codecontroler":"","listafilter":"0","var":"_status","i_pre":"","i_pos":""}},"codejs":"function onChangeProd(){\r\n  var dato=$('#fk_prod').val();\r\n    sel=$('#fk_prod').data('tag');\r\n    if (sel>0){\r\n      reaction('campo=fk_unidades&arg1=tipo&sel='+sel,'getListFor','','#fk_unidades',actualizarUI);\r\n    }\r\n}\r\n_setTask(onChangeProd,'_buscarDb');\r\n\r\nfunction onChangeTipo(){\r\n  var dato=$('#tipo').val();\r\n  if (dato=='T'){\r\n    $('#fk_almacenes').closest('.input-field').removeClass('s8').addClass('s4');\r\n    $('#fk_almacenes_2').closest('.input-field').show();\r\n  }else{\r\n    $('#fk_almacenes').closest('.input-field').removeClass('s4').addClass('s8');\r\n    $('#fk_almacenes_2').closest('.input-field').hide();\r\n  }\r\n}","codejsopenform":"onChangeProd();\r\nonChangeTipo();\r\n","codecontroler":"\r\n","codeaftersave":"$datos=$this->_model->loadToArray();\r\n$database = \\Mk\\Registry::get(\"database\");\r\n$unidad=$database->query()->first(\"select prod.pk, fk_unidades, unidades.relbase, uni2.relbase as relbase2 from prod left join unidades on (unidades.pk=fk_unidades) left join unidades as uni2 on (uni2.pk={$datos['fk_unidades']}) where (prod.pk={$datos['fk_prod']}) limit 1\");\r\n\r\n$datos['cant']=($datos['cant']*$unidad['relbase2'])\/$unidad['relbase'];\r\n\r\n$idProdAlm=$database->query()->first(\"select pk, cant from prodalm where (fk_prod={$datos['fk_prod']})and(fk_almacenes={$datos['fk_almacenes']}) limit 1\");\r\n$data['pk']=$idProdAlm['pk'];\r\n$data['cant']=$idProdAlm['cant']+$datos['cant'];\r\nif ($action=='add'){\r\n  $datap['cant']='cant+'.$datos['cant'];\r\n}\r\nif ($action=='edit'){\r\n  if (($datos['fk_prod']!=$this->dataAnt['fk_prod'])||($datos['fk_almacenes']!=$this->dataAnt['fk_almacenes'])){\r\n    $database->execute(\"update prodalm set cant=cant-{$this->dataAnt['cant']} where (fk_prod={$this->dataAnt['fk_prod']})and(fk_almacenes={$this->dataAnt['fk_almacenes']})\");\r\n  }else{\r\n    $data['cant']=$idProdAlm['cant']+$datos['cant']-$this->dataAnt['cant'];\r\n  }\r\n  $datap['cant']='cant+'.($datos['cant']-$this->dataAnt['cant']);\r\n}\r\nif (!($idProdAlm['pk']>0)){\r\n  $data=$datos;\r\n  $data['pk']='';\r\n}\r\n$prodAlm=new ProdAlm();\r\n$prodAlm->saveFromArray($data);\r\n$prod=new Prod();\r\n$datap['pk']=$datos['fk_prod'];\r\n$prod->saveFromArray($datap);\r\nreturn true;","codebeforesave":"if ($action=='edit'){\r\n  $this->dataAnt=$this->getDatosDb($this->_model->pk,'pk, cant, fk_prod, fk_almacenes');\r\n}\r\nreturn true;","codeafterdelete":"$database = \\Mk\\Registry::get(\"database\");\r\n$datos=$this->dataAnt;\r\n$unidad=$database->query()->first(\"select prod.pk, fk_unidades, unidades.relbase, uni2.relbase as relbase2 from prod left join unidades on (unidades.pk=fk_unidades) left join unidades as uni2 on (uni2.pk={$datos['fk_unidades']}) where (prod.pk={$datos['fk_prod']}) limit 1\");\r\n\r\n$datos['cant']=($datos['cant']*$unidad['relbase2'])\/$unidad['relbase'];\r\n$database->execute(\"update prodalm set cant=cant-{$datos['cant']} where (fk_prod={$datos['fk_prod']})and(fk_almacenes={$datos['fk_almacenes']})\");\r\n$database->execute(\"update prod set cant=cant-{$datos['cant']} where (pk={$datos['fk_prod']})\");\r\nreturn true;\r\n\r\n\r\n","codebeforedelete":"$this->dataAnt=$this->getDatosDb($id,'pk,cant,fk_prod,fk_almacenes,fk_unidades');\r\nreturn true;"}